{% extends 'base.html' %}
{% block title %}{{ anime.title }} · Anime Watchlist{% endblock %}
{% block content %}
	<div class="grid grid-cols-1 md:grid-cols-3 gap-6">
		<div>
			<img src="{{ anime.poster_url or 'https://placehold.co/400x600?text=Anime' }}" class="w-full rounded" alt="{{ anime.title }}" />
		</div>
		<div class="md:col-span-2">
			<h1 class="text-3xl font-bold mb-2">{{ anime.title }}</h1>
			<div class="text-slate-300 mb-3">{{ anime.type }} · {{ anime.release_year or '—' }} · {{ anime.total_episodes or '—' }} eps</div>
			<div class="flex flex-wrap gap-2 mb-3">
				{% for g in genres %}
					<span class="text-xs bg-slate-700 rounded px-2 py-1">{{ g }}</span>
				{% endfor %}
				{% for s in studios %}
					<span class="text-xs bg-cyan-700/40 rounded px-2 py-1">{{ s }}</span>
				{% endfor %}
			</div>
			<p class="text-slate-200 leading-relaxed mb-6">{{ anime.description or 'No description.' }}</p>

			{% if current_user %}
				<form method="post" action="{{ url_for('watchlist_add') }}" class="flex flex-wrap gap-2 items-end mb-6 p-4 bg-slate-800/60 rounded">
					<input type="hidden" name="anime_id" value="{{ anime.anime_id }}" />
					<div>
						<label class="block text-sm mb-1">Status</label>
						<select name="status" class="bg-slate-900 border border-slate-700 rounded px-3 py-2">
							{% for s in statuses %}
								<option value="{{ s }}" {% if user_watch and user_watch.status==s %}selected{% endif %}>{{ s|capitalize }}</option>
							{% endfor %}
						</select>
					</div>
					<div>
						<label class="block text-sm mb-1">Episodes Watched</label>
						<input name="episodes_watched" type="number" min="0" value="{{ user_watch.episodes_watched if user_watch else 0 }}" class="w-28 bg-slate-900 border border-slate-700 rounded px-3 py-2" />
					</div>
					<button class="bg-cyan-500 hover:bg-cyan-400 text-slate-900 font-semibold px-4 py-2 rounded">Save to Watchlist</button>
				</form>
			{% endif %}

			<h2 class="text-xl font-semibold mb-2">Reviews</h2>
			{% if current_user %}
				<form method="post" action="{{ url_for('review_add', anime_id=anime.anime_id) }}" class="space-y-3 mb-6 p-4 bg-slate-800/60 rounded">
					<div>
						<label class="block text-sm mb-1">Rating (1–10)</label>
						<input name="rating" type="number" min="1" max="10" class="w-24 bg-slate-900 border border-slate-700 rounded px-3 py-2" required />
					</div>
					<div>
						<label class="block text-sm mb-1">Review</label>
						<textarea name="review_text" rows="3" class="w-full bg-slate-900 border border-slate-700 rounded px-3 py-2" placeholder="Share your thoughts..."></textarea>
					</div>
					<button class="bg-emerald-500 hover:bg-emerald-400 text-slate-900 font-semibold px-4 py-2 rounded">Submit Review</button>
				</form>
			{% endif %}

			<div class="space-y-3">
				{% for r in reviews %}
					<div class="p-4 bg-slate-800/60 rounded">
						<div class="flex items-center justify-between mb-2">
							<div class="font-semibold">{{ r.username }}</div>
							<div class="text-sm text-yellow-300">★ {{ r.rating }}</div>
						</div>
						<div class="text-slate-200 whitespace-pre-wrap">{{ r.review_text or '' }}</div>
						<div class="text-xs text-slate-400 mt-2">{{ r.review_date }}</div>
						{% if current_user == r.username %}
							<form method="post" action="{{ url_for('review_delete', review_id=r.review_id) }}" class="mt-2">
								<button class="text-red-300 hover:text-red-200 text-sm">Delete</button>
							</form>
						{% endif %}
					</div>
				{% else %}
					<div class="text-slate-400">No reviews yet.</div>
				{% endfor %}
			</div>
		</div>
	</div>
{% endblock %}



